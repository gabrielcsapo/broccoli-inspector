<Progressbar
  @currentStep={{this.currentNode}}
  @isBuilding={{this.isBuilding}}
  @currentBuildTime={{this.currentBuildTime}}
  @totalBuildTime={{this.totalBuildTime}}
/>

<div class="container">
  <div class="flex-grid">
    {{#if this.isBuilding}}
      <div class="content-center">
        <EmptyState
          @iconType="truck-loading"
          @iconSize="4x"
          @title="Broccoli is currently building"
          @subtitle="This will refresh when broccoli is done building"
        />
      </div>
    {{else}}
      <div class="sidebar">
        <div class="sidebar-controls text-center p1">
          <label for="group-plugins">Group Plugins by Type</label>
          <input id="group-plugins" type="checkbox" checked={{this.groupPlugins}} {{on "change" this.toggleGroupingPlugins}}/>

          <input
            class="form--search"
            type="text"
            placeholder="Search for any value a node might contain"
            value={{@model.searchTerm}}
            {{on "change" this.search}}
          />
        </div>

        {{#if @model.nodes}}
          <i>Total time {{node-total-time @model.nodes}}ms</i>
        {{/if}}
        <div class="sidebar-content">
          {{#if this.pluginType}}
            <div class="plugin-selected">
              {{this.pluginType}}
              <button
                class="plugin-selected--clear"
                {{on "click" (fn this.selectPluginGroup "")}}
              >X</button>
            </div>
          {{/if}}

          <ul class="node-list">
            {{#if @model.nodesByType}}
              {{#each @model.nodesByType key="@index" as |node idx|}}
                <li class="node-list--items">
                  <a href="#" {{on "click" (fn this.selectPluginGroup node.label)}}>
                      ({{to-fixed node.time 3}}ms) {{node.label}} ({{node.nodes.length}})
                  </a>
                </li>
              {{/each}}
            {{else if @model.nodes}}
              {{#each @model.nodes key="@index" as |node idx|}}
                <li class="node-list--items">
                  <LinkTo @route="node" @model={{node.id}}>
                      ({{to-fixed node.buildState.selfTime 3}}ms) {{node.label}}
                  </LinkTo>
                </li>
              {{/each}}
            {{else}}
              Could not find any nodes for your search
            {{/if}}
          </ul>
        </div>
      </div>
      <div class="main">
        {{outlet}}
      </div>
    {{/if}}
  </div>
</div>
